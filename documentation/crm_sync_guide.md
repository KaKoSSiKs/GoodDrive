# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ CRM

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ CRM –≤ GoodDrive –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ –∑–∞–∫–∞–∑–æ–≤, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –∏—Å—Ç–æ—Ä–∏—é –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π.

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. **–ò–º–ø–æ—Ä—Ç timezone**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–º–ø–æ—Ä—Ç `timezone` –Ω–∞—Ö–æ–¥–∏–ª—Å—è –≤ –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞ `models.py`, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ `NameError`.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω –∏–º–ø–æ—Ä—Ç –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞:
```python
from django.utils import timezone
```

### 2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ distinct() –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `distinct()` –ø–æ—Å–ª–µ `values()` —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—è–º–∏ —Å–æ–∑–¥–∞–≤–∞–ª–æ –¥—É–±–ª–∏–∫–∞—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏.

**–ë—ã–ª–æ:**
```python
orders = Order.objects.values(
    'customer_name', 'customer_phone', 'customer_email', 'delivery_city'
).distinct()
```

**–°—Ç–∞–ª–æ:**
```python
unique_phones = Order.objects.exclude(
    customer_phone__isnull=True
).exclude(
    customer_phone=''
).values_list('customer_phone', flat=True).distinct()
```

### 3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞:
```python
if latest_order.customer_name and customer.name != latest_order.customer_name:
    customer.name = latest_order.customer_name
    updated = True
```

### 4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã try-except –±–ª–æ–∫–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
try:
    with transaction.atomic():
        # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
        ...
except Exception as e:
    error_count += 1
    logger.error(f"–û—à–∏–±–∫–∞: {str(e)}")
    continue
```

## üöÄ –°–ø–æ—Å–æ–±—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–°–∏–≥–Ω–∞–ª—ã Django)

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å CRM.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏–≥–Ω–∞–ª `post_save`
- –°–æ–∑–¥–∞–µ—Ç—Å—è –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞ –≤ CRM
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
–°–∏–≥–Ω–∞–ª—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `apps.py`:
```python
# backend/crm/apps.py
def ready(self):
    import crm.signals
```

### 2. –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ API

**Endpoint:** `POST /api/customers/sync_from_orders/`

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
# Bash/Linux/Mac
curl -X POST http://localhost:8000/api/customers/sync_from_orders/

# PowerShell (Windows)
Invoke-WebRequest -Uri "http://localhost:8000/api/customers/sync_from_orders/" -Method POST
```

**–û—Ç–≤–µ—Ç:**
```json
{
    "status": "success",
    "created_count": 15,
    "updated_count": 8,
    "error_count": 0,
    "total_customers": 150
}
```

### 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Django –∫–æ–º–∞–Ω–¥—É

#### –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
```bash
python manage.py sync_crm
```

#### –¢–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```bash
python manage.py sync_crm --update-stats-only
```

#### –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
```bash
python manage.py sync_crm --force-update
```

#### –í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
```bash
docker-compose -f docker-compose.dev.yml exec backend python manage.py sync_crm
```

## üìä –ß—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
- **–¢–µ–ª–µ—Ñ–æ–Ω** (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä)
- **–ò–º—è** (–∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞)
- **Email** (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
- **–ì–æ—Ä–æ–¥** (–∏–∑ –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏)

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤**
- **–û–±—â–∞—è —Å—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫**
- **–°—Ä–µ–¥–Ω–∏–π —á–µ–∫**
- **–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞**
- **–ö–∞—Ç–µ–≥–æ—Ä–∏—è –∫–ª–∏–µ–Ω—Ç–∞** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è)

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é:

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö—Ä–∏—Ç–µ—Ä–∏–∏ |
|-----------|----------|
| **–ù–æ–≤—ã–π** | 0 –∑–∞–∫–∞–∑–æ–≤ –∏–ª–∏ —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω |
| **–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π** | 3+ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞ |
| **VIP** | 10+ –∑–∞–∫–∞–∑–æ–≤ –ò–õ–ò —Å—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫ ‚â• 100,000‚ÇΩ |
| **–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π** | –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑ > 180 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ |

## üîß API Endpoints

### –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
```http
GET /api/customers/
```

**–§–∏–ª—å—Ç—Ä—ã:**
- `?category=vip` - –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `?search=–∏–≤–∞–Ω–æ–≤` - –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É, email
- `?ordering=-total_spent` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
```http
POST /api/customers/
Content-Type: application/json

{
  "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "phone": "+79991234567",
  "email": "ivan@example.com",
  "city": "–ú–æ—Å–∫–≤–∞",
  "address": "—É–ª. –õ–µ–Ω–∏–Ω–∞, 1"
}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
```http
PUT /api/customers/{id}/
PATCH /api/customers/{id}/
```

### –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞
```http
GET /api/customers/{id}/orders_history/
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞
```http
POST /api/customers/{id}/update_stats/
```

### –ú–∞—Å—Å–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
```http
POST /api/customers/sync_from_orders/
```

## üìù –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### Customer (–ö–ª–∏–µ–Ω—Ç)
```python
class Customer(models.Model):
    # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    name = models.CharField(max_length=200)
    phone = models.CharField(max_length=20, unique=True)
    email = models.EmailField(blank=True)
    city = models.CharField(max_length=100, blank=True)
    address = models.TextField(blank=True)
    
    # –ö–∞—Ç–µ–≥–æ—Ä–∏—è
    category = models.CharField(
        max_length=20,
        choices=CATEGORY_CHOICES,
        default='new'
    )
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    total_orders = models.PositiveIntegerField(default=0)
    total_spent = models.DecimalField(max_digits=12, decimal_places=2)
    average_order = models.DecimalField(max_digits=10, decimal_places=2)
    last_order_date = models.DateTimeField(null=True)
    
    # –ó–∞–º–µ—Ç–∫–∏
    notes = models.TextField(blank=True)
```

### CustomerNote (–ó–∞–º–µ—Ç–∫–∞ –æ –∫–ª–∏–µ–Ω—Ç–µ)
```python
class CustomerNote(models.Model):
    customer = models.ForeignKey(Customer, related_name='customer_notes')
    note = models.TextField()
    created_by = models.ForeignKey(User, null=True)
    created_at = models.DateTimeField(auto_now_add=True)
```

## üîÑ –õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—Å–∏–≥–Ω–∞–ª—ã):
1. **–ò–º—è**: –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—ã–ª–æ "–ë–µ–∑ –∏–º–µ–Ω–∏" –∏–ª–∏ –ø—É—Å—Ç–æ–µ
2. **Email**: –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—ã–ª –ø—É—Å—Ç—ã–º
3. **–ì–æ—Ä–æ–¥**: –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—ã–ª –ø—É—Å—Ç—ã–º

### –ü—Ä–∏ —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
- **–ë–µ–∑ --force-update**: –°–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã, —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è
- **–° --force-update**: –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤—Å–µ –ø–æ–ª—è –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
–í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
- –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã (`status='completed'`)
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ–±—â–∞—è —Å—É–º–º–∞, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
```python
import logging
logger = logging.getLogger('crm')
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ Docker:
```bash
docker-compose -f docker-compose.dev.yml logs -f backend | grep -i crm
```

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

#### –û—à–∏–±–∫–∞: "duplicate key value violates unique constraint"
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º.
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `get_or_create()`, —ç—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å.

#### –û—à–∏–±–∫–∞: "no such table: crm_customer"
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏.
**–†–µ—à–µ–Ω–∏–µ:**
```bash
python manage.py makemigrations crm
python manage.py migrate crm
```

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–∫–∞–∑—ã –Ω–µ –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å 'completed'.
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã
python manage.py shell
>>> from orders.models import Order
>>> Order.objects.create(
...     customer_name="–¢–µ—Å—Ç",
...     customer_phone="+79991234567",
...     customer_email="test@example.com",
...     delivery_city="–ú–æ—Å–∫–≤–∞",
...     delivery_address="–¢–µ—Å—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å",
...     total_amount=1000,
...     status='completed'
... )

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
python manage.py sync_crm

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
>>> from crm.models import Customer
>>> Customer.objects.get(phone="+79991234567")
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```python
permission_classes = [AllowAny]  # –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
–ò–∑–º–µ–Ω–∏—Ç–µ –≤ `backend/crm/views.py`:
```python
from rest_framework.permissions import IsAuthenticated, IsAdminUser

class CustomerViewSet(viewsets.ModelViewSet):
    permission_classes = [IsAdminUser]  # –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
```

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏: `python manage.py migrate`
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ CRM –≤ `INSTALLED_APPS`
- [ ] –°–∏–≥–Ω–∞–ª—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ `apps.py`
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–µ—Ä–≤–∏—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: `python manage.py sync_crm`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ API
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–†–µ–≥—É–ª—è—Ä–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫**: –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
3. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –±—ç–∫–∞–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
4. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ IsAdminUser –¥–ª—è API CRM

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ Django: `docker-compose logs backend`
2. –ú–∏–≥—Ä–∞—Ü–∏–∏: `python manage.py showmigrations crm`
3. –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–æ–≤: `python manage.py shell` ‚Üí `Order.objects.values_list('status', flat=True).distinct()`

